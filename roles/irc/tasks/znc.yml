- name: Add the ZNC PPA
  become: yes
  become_user: root
  apt_repository: repo='ppa:teward/znc' update_cache=yes
  when: not is_raspbian|bool

- name: Install ZNC
  become: yes
  become_user: root
  apt: name={{ item }} state=present
  with_items:
    - znc
    - znc-dev
    - znc-perl
    - znc-python

- name: Create a ZNC group
  become: yes
  become_user: root
  group: name=znc state=present

- name: Create a ZNC user
  become: yes
  become_user: root
  user: name=znc state=present system=yes group=znc home={{ znc_datadir }}

- name: Add the ZNC init script
  become: yes
  become_user: root
  template: src=etc/init.d/znc.j2
            dest=/etc/init.d/znc
            owner=root
            group=root
            mode=755

- name: Enable the ZNC service
  become: yes
  become_user: root
  service: name=znc enabled=true

- name: Create a directory for plugin repos
  become: yes
  become_user: root
  file: path={{ znc_datadir }}/lib/ state=directory owner=znc group=znc

- include: znc-push.yml user=znc
